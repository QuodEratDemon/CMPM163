
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>demo - Phong shader</title>
		<meta charset="utf-8">
		<style>
			body {
			  	margin: 0px;
				overflow: hidden;
			}
		</style>
	</head>
<body>

<div id="container"></div>

    <script src="js/three.js"></script>
    <script src="js/dat.gui.min.js"></script>
    <script src="js/cmgine.js"></script>
    <script id="vertexShader" type="x-shader/x-vertex">


	  attribute vec2 a_pos;
    attribute vec2 a_texcoord;

    uniform mat4 u_matrix;
    uniform vec2 u_texsize;

    varying vec2 v_texcoord;

    void main() {
       gl_Position = u_matrix * vec4(a_pos.xy, 0, 1);
      v_texcoord = a_texcoord / u_texsize;
    }

		</script>

		<script id="fragmentShader" type="x-shader/x-fragment">
      precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_color;
uniform float u_buffer;
uniform float u_gamma;
uniform float u_debug;

varying vec2 v_texcoord;

void main() {
    float dist = texture2D(u_texture, v_texcoord).r;
    if (u_debug > 0.0) {
        gl_FragColor = vec4(dist, dist, dist, 1);
    } else {
        float alpha = smoothstep(u_buffer - u_gamma, u_buffer + u_gamma, dist);
        gl_FragColor = vec4(u_color.rgb, alpha * u_color.a);
    }
}


    </script>


	<script>
				

  var container;
  var scene;
  var camera;
  var vs = document.getElementById( 'vertexShader' ).textContent;
  var fs = document.getElementById( 'fragmentShader' ).textContent;
  var tuniform;



	init();
	animate();

	function init() {

		container = document.getElementById( 'container' );
var width = window.innerWidth;
      var height = window.innerHeight;
		camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
      camera.position.z = 5;
		scene = new THREE.Scene();
    
    var tuniform = {
        iTime:    { type: 'f', value: 0.1 },
        iResolution: new THREE.Uniform(new THREE.Vector2(window.innerWidth, window.innerHeight)),
        iChannel0:  { type: 't', value: THREE.ImageUtils.loadTexture( 'angus.jpg') }

    };

    var plane = new THREE.PlaneBufferGeometry( window.innerWidth, window.innerHeight );
    var mat = new THREE.ShaderMaterial( {
            uniforms: tuniform,
            vertexShader: vs,
            fragmentShader: fs,            
            //side:THREE.DoubleSide
    } );
    var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
    var tobject = new THREE.Mesh( plane, mat);
    scene.add(tobject);


        	


		//make it so that resizing the browser window also resizes the scene


      renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );

    window.addEventListener( 'resize', onWindowResize, false );
	}

			

	function animate() {

		requestAnimationFrame( animate );
		render();

	}

	function render() {

		var time = performance.now();



		scene.children[0].material.uniforms.iTime.value = time/2000;//clock.getDelta();

		//if I want to update the lights, I acutally have to update the material used by each object in the scene. 
		//material.uniforms.light1_diffuse.value = new THREE.Vector3(0.0,1.0,0.0);

		renderer.render( scene, camera );
	}


	function onWindowResize( event ) {

		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();

		renderer.setSize( window.innerWidth, window.innerHeight );

	}


		</script>

	</body>
</html>

